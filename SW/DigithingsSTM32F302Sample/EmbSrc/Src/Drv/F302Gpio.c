#include "../Target/Target.h"
#include "../STM32F302_Gen/STM32F302_GPIOA_Def.h"
#include "../STM32F302_Gen/STM32F302_GPIOB_Def.h"
#include "../STM32F302_Gen/STM32F302_GPIOC_Def.h"

#define GPIO_INPUT_MODE_0 0
#define GPIO_OUTPUT_MODE_1 1
#define GPIO_ALTERNATE_FUNCTION_MODE_2 2
#define GPIO_ANALOG_MODE_3 3
#define GPIO_PUPD_MODE_PULL_UP_1 1

void F302GpioInitPortA(void) {
	volatile sSTM32F302_GPIOA* pSTM32F302_GPIOA = (sSTM32F302_GPIOA*)F302_GPIOA_ADR;
	volatile uSTM32F302_GPIOA_MODER STM32F302_GPIOA_MODER;
	volatile uSTM32F302_GPIOA_AFRL STM32F302_GPIOA_AFRL;

	STM32F302_GPIOA_AFRL.All = STM32F302_GPIOA_AFRL_RESET_VALUE;
	STM32F302_GPIOA_AFRL.Bit.AFRL5 = 1; /* Timer 2 Ch 1 */
	pSTM32F302_GPIOA->STM32F302_GPIOA_AFRL.All = STM32F302_GPIOA_AFRL.All;

	STM32F302_GPIOA_MODER.All = STM32F302_GPIOA_MODER_RESET_VALUE;
	STM32F302_GPIOA_MODER.Bit.MODER0 = GPIO_OUTPUT_MODE_1; /* Status Led */
	STM32F302_GPIOA_MODER.Bit.MODER1 = GPIO_ANALOG_MODE_3; /* CP In */
	STM32F302_GPIOA_MODER.Bit.MODER2 = GPIO_ANALOG_MODE_3; /* SOC In */
	STM32F302_GPIOA_MODER.Bit.MODER3 = GPIO_OUTPUT_MODE_1; /* Relais 230V Out */
	STM32F302_GPIOA_MODER.Bit.MODER4 = GPIO_OUTPUT_MODE_1; /* Led Authorization */
	STM32F302_GPIOA_MODER.Bit.MODER5 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* Neo Pixel */
	STM32F302_GPIOA_MODER.Bit.MODER8 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* MCO */
	pSTM32F302_GPIOA->STM32F302_GPIOA_MODER.All = STM32F302_GPIOA_MODER.All;
}

void F302GpioInitPortB(void) {
	volatile sSTM32F302_GPIOB* pSTM32F302_GPIOB = (sSTM32F302_GPIOB*)F302_GPIOB_ADR;
	volatile uSTM32F302_GPIOB_MODER STM32F302_GPIOB_MODER;
	volatile uSTM32F302_GPIOB_PUPDR STM32F302_GPIOB_PUPDR;
	volatile uSTM32F302_GPIOB_AFRL STM32F302_GPIOB_AFRL;

	STM32F302_GPIOB_AFRL.All = STM32F302_GPIOB_AFRL_RESET_VALUE;
	STM32F302_GPIOB_AFRL.Bit.AFRL3 = 6; /* SPI 3 SCLK */;
	STM32F302_GPIOB_AFRL.Bit.AFRL4 = 6; /* SPI 3 MISO */
	STM32F302_GPIOB_AFRL.Bit.AFRL5 = 6; /* SPI 3 MOSI */
	pSTM32F302_GPIOB->STM32F302_GPIOB_AFRL.All = STM32F302_GPIOB_AFRL.All;

	STM32F302_GPIOB_PUPDR.All = STM32F302_GPIOB_PUPDR_RESET_VALUE;
	STM32F302_GPIOB_PUPDR.Bit.PUPDR12 = GPIO_PUPD_MODE_PULL_UP_1;
	pSTM32F302_GPIOB->STM32F302_GPIOB_PUPDR.All = STM32F302_GPIOB_PUPDR.All;

	STM32F302_GPIOB_MODER.All = STM32F302_GPIOB_MODER_RESET_VALUE;
	STM32F302_GPIOB_MODER.Bit.MODER3 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* SPI_SCLK */
	STM32F302_GPIOB_MODER.Bit.MODER4 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* SPI_MISO */
	STM32F302_GPIOB_MODER.Bit.MODER5 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* SPI_MOSI */
	STM32F302_GPIOB_MODER.Bit.MODER12 = GPIO_INPUT_MODE_0; /* Lock Contact */
	pSTM32F302_GPIOB->STM32F302_GPIOB_MODER.All = STM32F302_GPIOB_MODER.All;
}

void F302GpioInitPortC(void) {
	volatile sSTM32F302_GPIOC* pSTM32F302_GPIOC = (sSTM32F302_GPIOC*)F302_GPIOC_ADR;
	volatile uSTM32F302_GPIOC_MODER STM32F302_GPIOC_MODER;
	uSTM32F302_GPIOC_AFRL STM32F302_GPIOC_AFRL;

	STM32F302_GPIOC_AFRL.All = STM32F302_GPIOC_AFRL_RESET_VALUE;
	STM32F302_GPIOC_AFRL.Bit.AFRL4 = 7; /* USART1 Tx */
	STM32F302_GPIOC_AFRL.Bit.AFRL5 = 7; /* USART1 RX */
	pSTM32F302_GPIOC->STM32F302_GPIOC_AFRL.All = STM32F302_GPIOC_AFRL.All;

	STM32F302_GPIOC_MODER.All = STM32F302_GPIOC_MODER_RESET_VALUE;
	STM32F302_GPIOC_MODER.Bit.MODER4 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* USART1 Tx */
	STM32F302_GPIOC_MODER.Bit.MODER5 = GPIO_ALTERNATE_FUNCTION_MODE_2; /* USART1 RX */
	STM32F302_GPIOC_MODER.Bit.MODER13 = GPIO_OUTPUT_MODE_1; /* SPI_CS_NFC */
	pSTM32F302_GPIOC->STM32F302_GPIOC_MODER.All = STM32F302_GPIOC_MODER.All;
}

void F302GpioInit(void) {
	F302GpioInitPortA();
	F302GpioInitPortB();
	F302GpioInitPortC();
}

