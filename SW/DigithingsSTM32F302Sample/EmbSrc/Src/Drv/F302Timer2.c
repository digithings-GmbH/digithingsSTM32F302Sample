#include "../Target/Target.h"
#include "../STM32F302_Gen/STM32F302_TIM2_Def.h"
#include "F302Timer2.h"

void F302Timer2Init(void) {

	volatile sSTM32F302_TIM2* pSTM32F302_TIM2 = (sSTM32F302_TIM2*)F302_TIM2_ADR;
	volatile uSTM32F302_TIM2_CCER STM32F302_TIM2_CCER;
	volatile uSTM32F302_TIM2_CCMR1_Output STM32F302_TIM2_CCMR1_Output;
	volatile uSTM32F302_TIM2_DIER STM32F302_TIM2_DIER;
	volatile uSTM32F302_TIM2_CR1 STM32F302_TIM2_CR1;
	volatile uSTM32F302_TIM2_ARR STM32F302_TIM2_ARR;
	volatile uSTM32F302_TIM2_CCR1 STM32F302_TIM2_CCR1;

	//STM32F302_TIM2_ARR.All = TIMER2_PERIOD_RELOAD_VALUE;
	STM32F302_TIM2_ARR.All = 57;
	STM32F302_TIM2_CCR1.All = 0;

	STM32F302_TIM2_CCER.All = 0;
	STM32F302_TIM2_CCER.Bit.CC1P = 0;
	STM32F302_TIM2_CCER.Bit.CC1E = 1;
	pSTM32F302_TIM2->STM32F302_TIM2_CCER.All = STM32F302_TIM2_CCER.All;

	STM32F302_TIM2_CCMR1_Output.All = 0;
	STM32F302_TIM2_CCMR1_Output.Bit.OC1M = 6;
	STM32F302_TIM2_CCMR1_Output.Bit.OC1PE = 1;

	//STM32F302_TIM2_EGR.All = 0;
	//STM32F302_TIM2_EGR.Bit.UG = 1;
	//STM32F302_TIM2_EGR.Bit.TG = 1;

	STM32F302_TIM2_DIER.All = 0;
	STM32F302_TIM2_DIER.Bit.TDE = 1;
	STM32F302_TIM2_DIER.Bit.CC1DE = 1;
	STM32F302_TIM2_DIER.Bit.TIE = 1;
	STM32F302_TIM2_DIER.Bit.UDE = 0;
	STM32F302_TIM2_DIER.Bit.UIE = 0;

	STM32F302_TIM2_CR1.All = 0;
	STM32F302_TIM2_CR1.Bit.CEN = 1;
	STM32F302_TIM2_CR1.Bit.UDIS = 0;
	STM32F302_TIM2_CR1.Bit.URS = 1;
	STM32F302_TIM2_CR1.Bit.OPM = 0;
	STM32F302_TIM2_CR1.Bit.DIR = 0;
	STM32F302_TIM2_CR1.Bit.CMS = 0;
	STM32F302_TIM2_CR1.Bit.ARPE = 1;
	STM32F302_TIM2_CR1.Bit.CKD = 0;

	pSTM32F302_TIM2->STM32F302_TIM2_ARR.All = STM32F302_TIM2_ARR.All;
	//pSTM32F302_TIM2->STM32F302_TIM2_PSC.All = STM32F302_TIM2_PSC.All;
	pSTM32F302_TIM2->STM32F302_TIM2_DIER.All = STM32F302_TIM2_DIER.All;
	pSTM32F302_TIM2->STM32F302_TIM2_CCR1.All = STM32F302_TIM2_CCR1.All;
	pSTM32F302_TIM2->STM32F302_TIM2_CCMR1_Output.All = STM32F302_TIM2_CCMR1_Output.All;
	pSTM32F302_TIM2->STM32F302_TIM2_CR1.All = STM32F302_TIM2_CR1.All;
	//pSTM32F302_TIM2->STM32F302_TIM2_EGR.All = STM32F302_TIM2_EGR.All;
}

